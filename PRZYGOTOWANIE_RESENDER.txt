# 🚧 DEV MODE - ZMIANY DO USUNIĘCIA PRZED PRODUKCJĄ

## ⚠️ WAŻNE: 
Te zmiany zostały dodane TYMCZASOWO aby pokazywać kod weryfikacyjny w alertcie, ponieważ Resend z `onboarding@resend.dev` może wysyłać tylko na email `easylesson.dev@gmail.com`.

**JAK SKONFIGURUJESZ DOMENĘ W RESEND - USUŃ TE ZMIANY!**

---

# 📁 PLIK 1: `backend/main.py`

## 🔴 ZMIANA #1 - Endpoint `/api/register` (linia ~55-60)

### ❌ BYŁO (PRODUKCYJNE):
```python
# Wyślij email z kodem weryfikacyjnym
await email_service.send_verification_email(new_user.email, new_user.username, verification_code)

return {"user": new_user, "message": "Użytkownik zarejestrowany. Sprawdź email."}
```

### ✅ JEST TERAZ (DEV MODE):
```python
# Wyślij email z kodem weryfikacyjnym
await email_service.send_verification_email(new_user.email, new_user.username, verification_code)

# 🚧 DEV MODE - zwróć kod w response (usuń przed produkcją!)
return {
    "user": new_user, 
    "message": "Użytkownik zarejestrowany. Sprawdź email.",
    "verification_code": verification_code  # ← USUŃ TĘ LINIĘ!
}
```

### 🔧 CO ZROBIĆ PRZED PRODUKCJĄ:
**USUŃ** linię:
```python
    "verification_code": verification_code  # ← USUŃ!
```

**Zostaw tylko:**
```python
return {
    "user": new_user, 
    "message": "Użytkownik zarejestrowany. Sprawdź email."
}
```

---

## 🔴 ZMIANA #2 - Endpoint `/api/resend-code` (linia ~130)

### ❌ BYŁO (PRODUKCYJNE):
```python
await email_service.send_verification_email(user.email, user.username, verification_code)

return {"message": "Nowy kod wysłany na email"}
```

### ✅ JEST TERAZ (DEV MODE):
```python
await email_service.send_verification_email(user.email, user.username, verification_code)

# 🚧 DEV MODE - zwróć kod
return {
    "message": "Nowy kod wysłany na email",
    "verification_code": verification_code  # ← USUŃ TĘ LINIĘ!
}
```

### 🔧 CO ZROBIĆ PRZED PRODUKCJĄ:
**USUŃ** linię:
```python
    "verification_code": verification_code  # ← USUŃ!
```

**Zostaw tylko:**
```python
return {"message": "Nowy kod wysłany na email"}
```

---

# 📁 PLIK 2: `src/app/rejestracja/page.tsx`

## 🔴 ZMIANA #3 - Funkcja `handleRegister` (linia ~155)

### ❌ BYŁO (PRODUKCYJNE):
```typescript
console.log("✅ Użytkownik zarejestrowany! ID:", response.user.id);
console.log("📧 Kod wysłany na email:", formData.email);

// Redirect do weryfikacji
router.push(`/weryfikacja?userId=${response.user.id}&email=${encodeURIComponent(formData.email)}`);
```

### ✅ JEST TERAZ (DEV MODE):
```typescript
console.log("✅ Użytkownik zarejestrowany! ID:", response.user.id);
console.log("📧 Kod wysłany na email:", formData.email);

// 🚧 DEV MODE - pokaż kod jeśli jest w response
if ((response as any).verification_code) {
  alert(`🔑 KOD WERYFIKACYJNY: ${(response as any).verification_code}\n\nSkopiuj ten kod!`);
}

// Redirect do weryfikacji
router.push(`/weryfikacja?userId=${response.user.id}&email=${encodeURIComponent(formData.email)}`);
```

### 🔧 CO ZROBIĆ PRZED PRODUKCJĄ:
**USUŃ** te 4 linie:
```typescript
// 🚧 DEV MODE - pokaż kod jeśli jest w response
if ((response as any).verification_code) {
  alert(`🔑 KOD WERYFIKACYJNY: ${(response as any).verification_code}\n\nSkopiuj ten kod!`);
}
```

---

# 📁 PLIK 3: `src/app/weryfikacja/page.tsx`

## 🔴 ZMIANA #4 - Funkcja `handleResendCode` (linia ~183)

### ❌ BYŁO (PRODUKCYJNE):
```typescript
try {
  await resendVerificationCode(parseInt(userId!));
  
  setResendMessage("✅ Nowy kod wysłany na email!");
  setResendCooldown(60);
  console.log("📧 Kod ponownie wysłany");

  // Wyczyść wiadomość po 5 sekundach
  setTimeout(() => setResendMessage(""), 5000);

} catch (error: any) {
  setError(error.message || "Błąd przy wysyłaniu kodu");
  console.error("❌ Błąd resend:", error);
} finally {
  setResendLoading(false);
}
```

### ✅ JEST TERAZ (DEV MODE):
```typescript
try {
  const data = await resendVerificationCode(parseInt(userId!));
  
  setResendMessage("✅ Nowy kod wysłany na email!");
  
  // 🚧 DEV MODE - pokaż kod jeśli jest
  if ((data as any).verification_code) {
    alert(`🔑 NOWY KOD: ${(data as any).verification_code}`);
  }
  
  setResendCooldown(60);
  console.log("📧 Kod ponownie wysłany");

  // Wyczyść wiadomość po 5 sekundach
  setTimeout(() => setResendMessage(""), 5000);

} catch (error: any) {
  setError(error.message || "Błąd przy wysyłaniu kodu");
  console.error("❌ Błąd resend:", error);
} finally {
  setResendLoading(false);
}
```

### 🔧 CO ZROBIĆ PRZED PRODUKCJĄ:
**USUŃ** te 4 linie:
```typescript
  // 🚧 DEV MODE - pokaż kod jeśli jest
  if ((data as any).verification_code) {
    alert(`🔑 NOWY KOD: ${(data as any).verification_code}`);
  }
```

**ZMIEŃ:**
```typescript
const data = await resendVerificationCode(parseInt(userId!));
```

**NA:**
```typescript
await resendVerificationCode(parseInt(userId!));
```

---

# ✅ CHECKLIST - PRZED PRODUKCJĄ (GDY DOMENA GOTOWA):

## Krok 1: Skonfiguruj domenę w Resend
- [ ] Kupiłem domenę
- [ ] Dodałem rekordy DNS
- [ ] Domena zweryfikowana w Resend
- [ ] Zaktualizowałem `FROM_EMAIL` w Render na `noreply@twoja-domena.xyz`

## Krok 2: Usuń DEV MODE z kodu

### Backend (`backend/main.py`):
- [ ] Usunąłem `"verification_code": verification_code` z `/api/register` (linia ~60)
- [ ] Usunąłem `"verification_code": verification_code` z `/api/resend-code` (linia ~135)

### Frontend (`src/app/rejestracja/page.tsx`):
- [ ] Usunąłem blok `if ((response as any).verification_code)` z `handleRegister` (linia ~158)

### Frontend (`src/app/weryfikacja/page.tsx`):
- [ ] Usunąłem blok `if ((data as any).verification_code)` z `handleResendCode` (linia ~185)
- [ ] Zmieniłem `const data = await` na `await` w `handleResendCode`

## Krok 3: Commit i deploy
```bash
git add backend/main.py src/app/rejestracja/page.tsx src/app/weryfikacja/page.tsx
git commit -m "Remove DEV MODE - production ready with custom domain"
git push origin main
```

## Krok 4: Test
- [ ] Zarejestrowałem się z dowolnym emailem
- [ ] Email przyszedł poprawnie (nie ma alertu z kodem!)
- [ ] Weryfikacja działa
- [ ] Wszystko działa jak produkcja

---

# 🔍 JAK SZYBKO ZNALEŹĆ TE ZMIANY:

## W VS Code:
1. Naciśnij `Ctrl + Shift + F` (Search w wszystkich plikach)
2. Szukaj: `DEV MODE`
3. Znajdziesz wszystkie miejsca do usunięcia!

## Lub szukaj komentarzy:
```
🚧 DEV MODE
```

---

# 📝 NOTATKI:

**Data dodania DEV MODE:** 29 października 2025

**Powód:** Resend z `onboarding@resend.dev` może wysyłać tylko na `easylesson.dev@gmail.com`. 
Tymczasowe rozwiązanie - pokazywanie kodu w alertcie dla testów z dowolnymi emailami.

**Do usunięcia:** Gdy domena będzie zweryfikowana w Resend i `FROM_EMAIL` zmieniony na `noreply@twoja-domena.xyz`

---

# ⚠️ DLACZEGO TO WAŻNE:

**Bezpieczeństwo:** Pokazywanie kodu weryfikacyjnego w response API to **OGROMNA DZIURA BEZPIECZEŃSTWA**!

Ktoś mógłby:
- Zarejestrować się cudzym emailem
- Od razu zobaczyć kod
- Zweryfikować konto bez dostępu do emaila

**Dlatego to TYLKO dla developmentu, NIGDY dla produkcji!**

---

**Zachowaj ten plik i usuń DEV MODE jak tylko skonfigurujesz domenę!** 🔒


# 🚀 PRZEWODNIK: Konfiguracja Domeny z Resend

## 📋 CZEGO POTRZEBUJESZ:
- Domeny (np. `platforma-edukacyjna.xyz`, `twoja-nazwa.com`)
- Dostęp do panelu DNS domeny
- 10-60 minut na propagację DNS

---

## 🎯 CEL:
Wysyłka emaili weryfikacyjnych na **dowolny** adres email (nie tylko Twój).

---

# CZĘŚĆ 1: ZAKUP DOMENY

## Gdzie kupić tanią domenę:

### **OPCJA 1: Namecheap (polecam!)**
- URL: https://www.namecheap.com
- Domena `.xyz` = **$1-2/rok** (najlepsza cena!)
- Domena `.com` = **$10-15/rok**
- Prosty panel DNS

### **OPCJA 2: Cloudflare**
- URL: https://www.cloudflare.com/products/registrar/
- Domena `.com` = **$10/rok** (cena bez marży)
- Świetny panel, szybkie DNS

### **OPCJA 3: Porkbun**
- URL: https://porkbun.com
- Różne domeny = **$2-15/rok**
- Prosty interface

---

## Co kupić:

Przykłady dobrych nazw:
- `platforma-edukacyjna.xyz` 💰 (najtaniej!)
- `easylesson.dev` 🎓
- `twoja-nazwa.com` 🌐

**Kup domenę i przejdź dalej!**

---

# CZĘŚĆ 2: DODANIE DOMENY W RESEND

## Krok 1: Zaloguj się do Resend
1. Idź na https://resend.com
2. Zaloguj się (ten sam email co wcześniej: `easylesson.dev@gmail.com`)

## Krok 2: Dodaj domenę
1. Kliknij **"Domains"** (lewy sidebar)
2. Kliknij **"Add Domain"** (niebieski przycisk)
3. Wpisz swoją domenę: `twoja-domena.xyz`
4. Wybierz **"Subdomain"** lub **"Root domain"**
   - **Root domain** (`twoja-domena.xyz`) - email będzie `noreply@twoja-domena.xyz`
   - **Subdomain** (`mail.twoja-domena.xyz`) - email będzie `noreply@mail.twoja-domena.xyz`
   
   **Polecam: Root domain** (prostsze)

5. Kliknij **"Add Domain"**

## Krok 3: Skopiuj DNS Records
Resend pokaże Ci **3-4 rekordy DNS** do dodania:

### Będą wyglądać mniej więcej tak:

#### **1. MX Record** (wysyłka emaili)
```
Type: MX
Name: @ (lub twoja-domena.xyz)
Value: feedback-smtp.us-east-1.amazonses.com
Priority: 10
TTL: Auto lub 3600
```

#### **2. TXT Record #1** (weryfikacja SPF)
```
Type: TXT
Name: @ (lub twoja-domena.xyz)
Value: v=spf1 include:amazonses.com ~all
TTL: Auto lub 3600
```

#### **3. TXT Record #2** (DKIM - weryfikacja)
```
Type: TXT
Name: resend._domainkey (lub coś podobnego)
Value: p=MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKB... (długi klucz)
TTL: Auto lub 3600
```

#### **4. CNAME Record** (tracking - opcjonalny)
```
Type: CNAME
Name: em1234 (lub podobne)
Value: u12345678.wl123.sendgrid.net (lub podobne)
TTL: Auto lub 3600
```

**WAŻNE:** Skopiuj DOKŁADNIE te wartości z Resend - będą inne dla Twojej domeny!

**Zostaw tę stronę otwartą - przejdziemy do panelu domeny!**

---

# CZĘŚĆ 3: KONFIGURACJA DNS W PANELU DOMENY

## Dla Namecheap:

### Krok 1: Otwórz panel DNS
1. Zaloguj się na https://namecheap.com
2. **Dashboard** → **Domain List**
3. Znajdź swoją domenę → kliknij **"Manage"**
4. Zakładka **"Advanced DNS"**

### Krok 2: Dodaj rekordy
Dla każdego rekordu z Resend:

1. Kliknij **"Add New Record"**
2. Wybierz **Type** (MX, TXT, CNAME)
3. Wpisz **Host** (Name z Resend, np. `@` lub `resend._domainkey`)
4. Wpisz **Value** (skopiuj DOKŁADNIE z Resend)
5. Dla MX: ustaw **Priority** na `10`
6. TTL: `Automatic` lub `3600`
7. Kliknij **"Save Changes"**

Powtórz dla wszystkich 3-4 rekordów!

---

## Dla Cloudflare:

### Krok 1: Otwórz panel DNS
1. Zaloguj się na https://dash.cloudflare.com
2. Wybierz swoją domenę
3. Kliknij **"DNS"** → **"Records"**

### Krok 2: Dodaj rekordy
Dla każdego rekordu z Resend:

1. Kliknij **"Add record"**
2. **Type**: wybierz (MX, TXT, CNAME)
3. **Name**: wpisz z Resend (np. `@`, `resend._domainkey`)
4. **Content**: skopiuj Value z Resend
5. **TTL**: `Auto`
6. **Proxy status**: 🔴 **DNS only** (WAŻNE! Wyłącz proxy!)
7. Kliknij **"Save"**

Powtórz dla wszystkich rekordów!

---

## Dla innych providerów:

Ogólna zasada:
1. Znajdź **"DNS Management"** lub **"DNS Records"**
2. Dodaj każdy rekord z Resend:
   - **Type**: MX, TXT, lub CNAME
   - **Name/Host**: dokładnie z Resend
   - **Value/Content**: dokładnie z Resend
   - **Priority**: 10 (tylko dla MX)
   - **TTL**: Auto lub 3600

---

# CZĘŚĆ 4: WERYFIKACJA W RESEND

## Krok 1: Poczekaj na propagację DNS
- Minimum: **10 minut**
- Maksimum: **48 godzin** (zazwyczaj ~1 godzina)

Sprawdź status:
1. Wróć do Resend → **Domains**
2. Twoja domena pokaże status:
   - ⏳ **Pending** - czekaj
   - ✅ **Verified** - GOTOWE!
   - ❌ **Failed** - sprawdź rekordy DNS

## Krok 2: Wymuszenie sprawdzenia (opcjonalne)
W Resend kliknij **"Verify"** przy domenie - sprawdzi ponownie.

---

# CZĘŚĆ 5: AKTUALIZACJA BACKENDU (RENDER)

Gdy domena jest **zweryfikowana** w Resend:

## Krok 1: Render Dashboard
1. Idź na https://dashboard.render.com
2. Znajdź projekt **platforma-edukacyjna**
3. Kliknij na niego

## Krok 2: Edytuj Environment Variables
1. Kliknij **"Environment"** (lewy sidebar)
2. Znajdź **`FROM_EMAIL`**
3. Kliknij **"Edit"** (ołówek)
4. **ZMIEŃ wartość z:**
   ```
   onboarding@resend.dev
   ```
   **NA:**
   ```
   noreply@twoja-domena.xyz
   ```
   (Użyj SWOJEJ domeny!)
5. Kliknij **"Save Changes"**

## Krok 3: Redeploy
Render automatycznie zrestartuje backend - poczekaj ~30 sekund.

---

# CZĘŚĆ 6: TEST!

## Sprawdź czy działa:

1. Idź na Twoją aplikację (Vercel URL)
2. Zarejestruj się z **DOWOLNYM** emailem (np. `test@gmail.com`)
3. Sprawdź skrzynkę odbiorczą (oraz SPAM!)
4. Powinieneś dostać email z kodem weryfikacyjnym

---

# 🎉 GOTOWE!

Teraz możesz wysyłać emaile na **dowolny** adres!

---

# 📊 PODSUMOWANIE - CO ZMIENIAMY:

## Resend:
- ✅ Dodana domena
- ✅ Domena zweryfikowana

## DNS (Namecheap/Cloudflare):
- ✅ Dodane rekordy MX, TXT, CNAME

## Render (Backend):
- ✅ `FROM_EMAIL` = `noreply@twoja-domena.xyz`

## Vercel (Frontend):
- ❌ **NIC** - frontend nie wymaga zmian!

---

# ⚠️ TROUBLESHOOTING

## Problem: "Domain not verified" w Resend
**Rozwiązanie:**
1. Sprawdź czy rekordy DNS są dodane DOKŁADNIE jak w Resend
2. Poczekaj dłużej (do 24h)
3. Użyj narzędzia: https://mxtoolbox.com/SuperTool.aspx
   - Wpisz swoją domenę
   - Sprawdź czy widzi rekordy MX, SPF, DKIM

## Problem: "550 5.7.1 Unauthenticated email from domain"
**Rozwiązanie:**
- Sprawdź rekord SPF (TXT): `v=spf1 include:amazonses.com ~all`
- Sprawdź rekord DKIM (TXT z `_domainkey`)

## Problem: Email trafia do SPAM
**Rozwiązanie:**
- Dodaj rekord DMARC (opcjonalny):
  ```
  Type: TXT
  Name: _dmarc
  Value: v=DMARC1; p=none; rua=mailto:twoj-email@twoja-domena.xyz
  ```
- Poczekaj kilka dni - nowe domeny często trafiają do SPAM
- Testuj z różnymi providerami (Gmail, Outlook, etc.)

## Problem: "Domain already exists"
**Rozwiązanie:**
- Domena może być dodana w innym koncie Resend
- Usuń ją z tamtego konta lub użyj subdomeny: `mail.twoja-domena.xyz`

---

# 🔗 PRZYDATNE LINKI

- Resend Dashboard: https://resend.com/domains
- Render Dashboard: https://dashboard.render.com
- MX Toolbox (test DNS): https://mxtoolbox.com
- Mail Tester (test emaili): https://www.mail-tester.com

---

# 💡 DODATKOWE WSKAZÓWKI

## Rekomendowany email sender:
```
noreply@twoja-domena.xyz
```

## Możliwe warianty:
```
hello@twoja-domena.xyz
support@twoja-domena.xyz
team@twoja-domena.xyz
```

## Custom sender name:
W `backend/email_service.py` możesz zmienić:
```python
from_email="Platforma Edukacyjna <noreply@twoja-domena.xyz>"
```

---

# ✅ CHECKLIST - ZAZNACZ JAK ZROBISZ:

- [ ] Kupiłem domenę
- [ ] Dodałem domenę w Resend
- [ ] Dodałem rekordy DNS w panelu domeny
- [ ] Domena zweryfikowana w Resend (✅)
- [ ] Zaktualizowałem `FROM_EMAIL` w Render
- [ ] Przetestowałem rejestrację z nowym emailem
- [ ] Email przyszedł poprawnie
- [ ] Weryfikacja działa

---

**Powodzenia! 🚀**

Jak skończysz setup, przetestuj z różnymi emailami (Gmail, Outlook, Yahoo) żeby upewnić się że wszystko działa!